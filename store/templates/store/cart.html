{% extends 'store/base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
  <h2 class="mb-4">Your Cart</h2>

  {% if order.items.all %}
    <div class="row">
      {% for item in order.items.all %}
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm h-100">
            {% if item.product.image %}
              <img src="{{ item.product.image.url }}" class="card-img-top" alt="{{ item.product.name }}">
            {% else %}
              <img src="{% static 'store/placeholder.jpg' %}" class="card-img-top" alt="No image">
            {% endif %}
            <div class="card-body">
              <h5 class="card-title">{{ item.product.name }}</h5>
              <p class="card-text">Price: €{{ item.product.price }}</p>
              <p class="card-text">Quantity: {{ item.quantity }}</p>
              <p class="card-text">Subtotal: €{{ item.subtotal }}</p>

              <div class="d-flex justify-content-between">
                <a href="{% url 'decrement_from_cart' item.product.id %}" class="btn btn-outline-secondary btn-sm">-</a>
                <a href="{% url 'add_to_cart' item.product.id %}" class="btn btn-outline-secondary btn-sm">+</a>
                <a href="{% url 'remove_from_cart' item.product.id %}" class="btn btn-danger btn-sm">Remove</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="card shadow-sm mt-4">
  <div class="card-header"><strong>Order Summary</strong></div>
  <div class="card-body">
    {% if voucher %}
      <div class="d-flex justify-content-between">
        <span>Subtotal</span>
        <span>€{{ total|floatformat:2 }}</span>
      </div>
      <div class="d-flex justify-content-between text-success">
        <span>Voucher “{{ voucher.code }}” ({{ voucher.discount }}% off)</span>
        <span>−€{{ discount|floatformat:2 }}</span>
      </div>
      <hr>
      <div class="d-flex justify-content-between fs-5 fw-bold">
        <span>Total</span>
        <span>€{{ new_total|floatformat:2 }}</span>
      </div>
    {% else %}
      <div class="d-flex justify-content-between fs-5 fw-bold">
        <span>Total</span>
        <span>€{{ total|floatformat:2 }}</span>
      </div>
    {% endif %}

    <form action="{% url 'vouchers:apply' %}" method="post" class="mt-3">
      {% csrf_token %}
      <div class="input-group">
        {{ voucher_apply_form.code }}   {# has form-control if you set it in the widget #}
        <button class="btn btn-outline-success" type="submit">Apply</button>
      </div>
    </form>

    <div class="d-grid mt-3">
      <a class="btn btn-success btn-lg" href="{% url 'checkout' %}">
        Proceed to Checkout
      </a>
    </div>

  </div>
</div>


  {% else %}
    <div class="alert alert-info text-center">
      Your cart is empty. <a href="{% url 'product_list' %}" class="alert-link">Shop now</a>
    </div>
  {% endif %}
</div>
{% endblock %}
